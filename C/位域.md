# 位域

如果用结构体来保存一些**开关量**，这些开关量通常只存储0或1，C语言提供了一种更好的利用内存空间的方式。

如果使用通常的结构体，每一个成员变量都是占满了字节位，如果使用位域，则可以告诉编译器这个开关量占用了多少二进制位

例如：

如果不使用位域，每一个变量将占用4字节，整个结构体占用8字节

```c
struct
{
  unsigned int widthValidated;
  unsigned int heightValidated;
} status;
```

如果使用位域，每一个变量只占用1个二进制位(1字节=8二进制位)，整个结构体占用4个字节位，但只有2位用来存储；如果使用32个变量，还是占用4个字节位，33个变量会变成8个字节位

```c
struct
{
  unsigned int widthValidated : 1;
  unsigned int heightValidated : 1;
} status;
```

和下面的结构体占用的空间等效：

```c
//共有32个成员变量
struct
{
  unsigned int widthValidated : 1;
  ........
  unsigned int heightValidated : 1;
} status;
```

## 位域声明

有些信息在存储时，并不需要占用一个完整的字节，而只需占几个或一个二进制位。例如在存放一个开关量时，只有 0 和 1 两种状态，用 1 位二进位即可。为了节省存储空间，并使处理简便，C 语言又提供了一种数据结构，称为"位域"或"位段"。

**"位域"**是把一个字节中的二进位划分为几个不同的区域，并说明每个区域的位数。每个域有一个域名，允许在程序中按域名进行操作。这样就可以把几个不同的对象用一个字节的二进制位域来表示。

```c
struct 位域结构名 
{

	//位域列表
  
  type [member_name] : width ;

};
```



位域可以是无名位域，这时它只用来作填充或调整位置。无名的位域是不能使用的。例如：

```c
struct k{
    int a:1;
    int  :2;    /* 该 2 位不能使用 */
    int b:3;
    int c:2;
};
```



从以上分析可以看出，位域在本质上就是一种结构类型，不过其成员是按二进位分配的。

## 示例

示例，含有指针：

```c
#include <stdio.h>
 
int main(){
    struct bs{
        unsigned a:1;
        unsigned b:3;
        unsigned c:4;
    } bit,*pbit;
    bit.a=1;    //给位域赋值（应注意赋值不能超过该位域的允许范围）
    bit.b=7;    //给位域赋值（应注意赋值不能超过该位域的允许范围） 
    bit.c=15;    //给位域赋值（应注意赋值不能超过该位域的允许范围） 
    printf("%d,%d,%d\n",bit.a,bit.b,bit.c);    //以整型量格式输出三个域的内容 
  
    pbit=&bit;    // 把位域变量 bit 的地址送给指针变量 pbit 
    pbit->a=0;    // 用指针方式给位域 a 重新赋值，赋为 0 
    pbit->b&=3;    //位域 b 中原有值为 7，与 3 作按位与运算的结果为 3（111&011=011，十进制值为 3） 
    pbit->c|=1;    //使用了复合位运算符"|="，相当于：pbit->c=pbit->c|1，其结果为 15 
    printf("%d,%d,%d\n",pbit->a,pbit->b,pbit->c);    // 用指针方式输出了这三个域的值 
}
```



