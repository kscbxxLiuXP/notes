# ABI

## 简介

`ABI`规范了在某一个特点的体系结构下，CPU和对应内核的工作规范，该ABI通常约束了编译器的行为，也可以理解为编译器适配该平台时，需要遵循对应的ABI规范，将同样的源码转化为目标平台的机器码。

一个例子就是ABI规范中的函数调用参数存放在哪个寄存器中

下面是`ChatGPT`对于`ABI`规范的总结：

---

`ABI（Application Binary Interface）`规范是一种定义了应用程序与操作系统或硬件之间接口的标准。它规定了<u>函数调用约定</u>、<u>参数传递方式</u>、<u>寄存器的使用</u>、<u>内存布局</u>等方面的规则，以确保不同模块之间的二进制兼容性和互操作性。

ABI规范的主要目的是在不同编译器、操作系统和硬件平台上实现二进制级别的兼容性。通过遵循ABI规范，可以确保编译的程序在不同的环境中能够正确地链接、加载和执行。

以下是一些常见的ABI规范内容和示例：

1. 函数调用约定：ABI规范定义了函数调用时参数的传递方式、寄存器的使用和返回值的处理方式。例如，x86平台的CDECL调用约定要求函数参数从右向左依次压入堆栈，而返回值通常存储在EAX寄存器中。

2. 参数传递方式：ABI规范定义了函数参数在寄存器和堆栈之间的分配方式。例如，x86-64平台的System V ABI规范要求前6个整型或指针类型的参数存储在寄存器中，而超过6个的参数则存储在堆栈中。

3. 寄存器的使用：ABI规范规定了哪些寄存器用于保存临时数据、函数调用时的参数传递和返回值。例如，ARM平台的AAPCS（ARM Architecture Procedure Call Standard）规范指定了R0-R3寄存器用于函数参数传递，R0寄存器用于返回值。

4. 内存布局：ABI规范定义了可执行文件、共享库和进程的内存布局。它规定了代码段、数据段、堆栈和其他数据结构在内存中的位置和排列方式。

5. 异常处理：ABI规范还定义了异常处理的规则，包括如何传递异常、如何进行栈展开和恢复等。

这些只是ABI规范中的一些常见内容，具体的规范会因不同的平台、操作系统和编译器而有所不同。遵循ABI规范可以确保不同模块之间的二进制兼容性，使得它们可以在同一系统上相互调用和交互，而无需关心具体的实现细节。

## 定义

`ABI`是指应用程序二进制接口(Application Binary Interface),

它定义了**应用程序与操作系统之间进行交互的方式和规范**，确保不同的软件组件能够正确地协同工作。ABI包括了函数调用约定、寄存器的使用、参数传递方式、系统调用接口等内容，为软件开发者提供了一个稳定和一致的编程接口。

## 规则

> ABI 是编译器和链接器遵守的一组规则，以让编译后的程序可以正常工作。

每一个不同的系统和架构都有自己的一个ABI规范，编译器根据对应的ABI规范，将源码编译成对应的二进制可执行文件(ELF),保证可执行文件在当前系统和架构上是兼容可以运行的

比如一些具体的ABI规范：

- ABI 最大和最重要的部分是规定函数的调用顺序，也称为“调用约定”。调用约定标准化了如何将“函数”转换为汇编代码。
- ABI 还规定了库中公开函数的name（如printf）应该如何表示，以便在链接后可以正确的调用这些库函数并接收参数。
- ABI 还规定可以使用什么类型的数据类型、它们必须如何对齐以及其他低级细节。
- ABI还涉及操作系统的内容，如可执行文件的格式，虚拟地址空间布局，还有Program Loading and Dynamic Linking等细节。

